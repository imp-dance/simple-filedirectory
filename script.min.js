$(document).ready(function(){function a(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function b(){var a=document.getElementById("container");a.scrollTop=a.scrollHeight}function d(a){return a.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}function e(a){window.prompt("Copy to clipboard: Ctrl+C, Enter",a)}var c;$("#container").on("click","a.upyes",function(c){return $(".uploadbox").hide(),$(".fname").val(a()+"-"+d($(".fname").val())),$("#container").append("<span class='code'>start upload? [yes]</span>"),$("#container").append("<span class='cmd-cont'>loading...</span>"),b(),$(".submitbutton").click(),$(".isup").val("fa"),c.preventDefault,!1}),$("#container").on("click","a.upno",function(a){return $("#container").append("<span class='code'>start upload? [no]</span>"),b(),$(".uploadbox").hide(),$(".isup").val("fa"),document.getElementById("fileupload").value="",a.preventDefault,!1});var f;$("#input input").focus(),$("#container").click(function(){$("#input input").focus()}),$("#cmd").bind("leftKey",function(a){return a.preventDefault,$("#cmd").val($(".lastcmd").val()),!1}),$("#container").bind("tabKey",function(a){return a.preventDefault,$("*[tabindex='1']").focus(),!1}),$("#fileupload").focus(function(a){return a.preventDefault,$("#container").focus(),!1}),$("#fileupload").bind("tabKey",function(a){return a.preventDefault,$("*[tabindex='1']").focus(),!1}),$("#cmd").bind("enterKey",function(a){a.preventDefault();var d=$(this).val();if(c=1,$(".lastcmd").val(d),$(this).val(""),d.match("^setup dl"))$("#fileupload").click(),$("#container").append("<span class='code'>"+d+"</span><span class='cmd-cont'>please select a file...</span>"),b(),"setup dl"==d||"setup dl "==d||(f=d,f=d.substr(9,60),console.log("filename: "+f),$(".fname").val(f));else if(d.match("^help"))$("#container").append("<span class='code'>"+d+"</span><span class='cmd-cont'>available functions: <br /><ul><li>setup dl <strong>filename</strong></li><li>search <strong>filename</strong></li><li>clear<strong>/</strong>cls</li><li>list</li><li>help</li></ul>Press the up arrow to finish a command, press <strong>'</strong> to enter the last command<br />If a file is visible through search/list, then you can copy it's link with <ul><li>copy <strong>filename.ext</strong></li></ul> or open the link with <ul><li>go <strong>filename.ext</strong></li></ul>Press enter to scroll to the bottom of the page. You can also drag and drop files to upload.</span>"),b();else if(d.match("^clear")||d.match("^cls"))"tr"==$(".isup").attr("value")?($("#container").append("<span class='code'>"+d+"</span><span class='cmd-cont'>error: please answer yes/no first</span>"),history.pushState(null,null,"/?"+c),c++,b()):$("#container").html("");else if(d.match("^rename "))if("tr"==$(".isup").attr("value")){var g=d.substr(7,60);$(".fname").val(g),$("#container").append("<span class='code'>"+d+"</span><span class='cmd-cont'>file renamed to <strong>"+g+"</strong></span>"),b()}else $("#container").append("<span class='code'>"+d+"</span><span class='cmd-cont'>error: no file to rename</span>"),b();else if(d.match("^yes"))if("tr"==$(".isup").attr("value"))$(".upyes").click();else{var h=["uhm...","not sure what you are answering...","huh?"],i=Math.floor(Math.random()*h.length);$("#container").append("<span class='code'>"+d+"</span><span class='cmd-cont'>"+h[i]+"</span>"),b()}else if(d.match("^no"))if("tr"==$(".isup").attr("value"))$(".upno").click();else{var h=["uhm...","not sure what you are answering...","huh?"],i=Math.floor(Math.random()*h.length);$("#container").append("<span class='code'>"+d+"</span><span class='cmd-cont'>"+h[i]+"</span>"),b()}else if(d.match("^search "))$(".searchcont").hide(),$("#container").append("<span class='code'>"+d+"</span>"),$("#container").append($("<div class='searchcont'>").load("/list.php #listfileul",function(){var a=$('.searchcont li:contains("'+d.substr(7,80)+'")');$(".searchcont li").hide(),a.show(),b(),$("#container").append("<span class='cmd-cont'>"+$(".searchcont li:visible").length+" result(s).</span>")})),b();else if(d.match("^copy")&&!d.match("^copy "))1==hasUploaded&&e($(".filelink").attr("href"));else if(d.match("^go")&&!d.match("^go "))1==hasUploaded&&(window.location.href=$(".filelink").attr("href"));else if(d.match("^go ")){var j=d.substr(3,80),k=$(".listlink").filter(function(){return $(this).text()===j}).attr("href");if(null!=k){window.location.href=k}}else if(d.match("^copy ")){var m=d.substr(5,80),n=$(".listlink").filter(function(){return $(this).text()===m}).attr("href");if(null!=n){var n="http://cmd.underbakke.net"+n;e(n)}}else d.match("^list")?($("#container").find("#listfileul").hide(),$("#container").append("<span class='code'>"+d+"</span><span class='cmd-cont'>loading all files...<br /><strong>press tab to browse files</strong></span>"),$("#container").append($("<div>").load("/list.php #listfileul")),$("#container").append("<span class='cmd-cont'>files loaded</span>"),b()):d.match("^focus")?$(".listlink").length&&$('.listlink[tabindex="1"]').focus():""==d&&b();return!1}),$("#cmd").keyup(function(a){13==a.keyCode?$(this).trigger("enterKey"):222==a.keyCode?$(this).trigger("leftKey"):9==a.keyCode&&$(this).trigger("tabKey")}),$(function(){$("input:file").change(function(){$(".isup").val("tr");var a,c=$(this).val();if(c=c.substr(12,60),c=c.substring(0,c.indexOf(".")),""==$(".fname").val()){var d=c;$(".fname").val(c),a=""}else{var d=$(".fname").val();a=""}$("#container").append("<span class='cmd-cont'>file <strong>"+c+"</strong> selected. "+a+"<br /><div class='dialogbox uploadbox'><i>do you want to start the upload?</i><br /><a href='#yes' class='upyes'>Yes</a> <a class='upno' href='#no'>No</a></span></div><div class='cmd-cont'>to rename the file, use the 'rename <strong>new name</strong>' command.</div>"),$("#container").append("<span class='cmd-cont'>current filename is: <strong>"+d+"</strong></span>"),b()})}),$("#container").on("click",".openimgl",function(){"(embed)"==$(this).text()?($("<div class='imgpreview' data-refimg='"+$(this).data("imglink")+"'><img src='"+$(this).data("imglink")+"' /></div>").appendTo($(this).parent("li")),$(this).text("close")):($(".imgpreview[data-refimg='"+$(this).data("imglink")+"']").remove(),$(this).text("(embed)"))}),$("#container").on("click",".openvidl",function(){"(embed)"==$(this).text()?($("<div class='vidpreview' data-refvid='"+$(this).data("vidlink")+"'><video src='"+$(this).data("vidlink")+"' controls /></div>").appendTo($(this).parent("li")),$(this).text("close")):($(".vidpreview[data-refvid='"+$(this).data("vidlink")+"']").remove(),$(this).text("(embed)"))}),$("#container").on("click",".openaudl",function(){"(embed)"==$(this).text()?($("<div class='audpreview' data-refaud='"+$(this).data("audlink")+"'><audio src='"+$(this).data("audlink")+"' controls /></div>").appendTo($(this).parent("li")),$(this).text("close")):($(".audpreview[data-refaud='"+$(this).data("audlink")+"']").remove(),$(this).text("(embed)"))})}),$(function(){var a=["setup dl ","help","echo ","clear","cls","rename ","search ","list","go","copy","yes","no"];$("#cmd").autocomplete({source:a})}),$(document).on("keypress",".listlink",function(a){65==a.which&&(a.preventDefault(),$("#input input").focus(),console.log("cl"))});